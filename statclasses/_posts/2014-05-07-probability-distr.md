---
title: "Розподіл ймовірності"
author: Девіняк Олег
tags: [R, розподіл, основи статистики]
date: "2014-05-07"
layout: post
category: statclasses
--- 

Поняття імовірності є інтуїтивно зрозумілим і досить часто використовуваним навіть у побуті. Загалом, імовірність є числовою характеристикою можливості настання випадкової події. Фармація також широко використовує концепцію ймовірності. Так, випадковою подією може бути:

- Побічна дія лікарського засобу при прийомі. Так, часто в інструкціях до медичного застосування вказують імовірність прояву того чи іншого небажаного явища, пов'язаного із прийомом препарату.
- Прихід відвідувача в аптеку в заданий інтервал часу. 
- Випуск одиниці неякісного (бракованого) лікарського препарату
- Виявлення сполуки з високим рівнем  біологічної активності і т.д.

Кожна подія, про яку наперед невідомо, відбудеться вона чи ні, є випадковою. Так, навіть для відмінника, успішне складання тестового іспиту КРОК є випадковою подією (хоч її імовірність є дуже високою). Із поняттям випадкової події тісно пов'язаний термін "випадкова величина". Випадковою є величина, яка може примати різні значення при її вимірюванні, причому наперед невідомо, яке точне значення прийме результат вимірювання. Таким чином, отримання певного результату вимірювання є настанням певної події із множини можливих випадкових подій.

Розглянемо на прикладі: провівши визначення кількість відвідувачів аптеки за день, отримали число 284. Якщо визначити кількість відвідувачів у наступний день, то буде отримано інше число. Наперед невідомо, яка саме кількість відвідувачів буде у наступний день. Тому кількість відвідувачів є випадковою величиною. Нехай існує множина едементарних подій: {"За день було 0 відвідувачів", "За день був 1 відвідувач", "За день були 2 відвідувачі", ... , "За день були 7612 відвідувачів", ... }.  В той день, коли ми проводили вимірювання, відбулась подія "За день були 284 відвідувачі" і не відбулись всі інші (а взагалі, в один день не може існувати дві кількості відвідувачів. Такі події, які не можуть відбутись одночасно, називаються несумісними). Наперед не було відомо, яка з цих подій відбудеться. Тому отримання результату вимірювання випадкової величини є випадковою подією. На цьому прикладі очевидно, що ймовірність спостерігати 0, 1 чи 2 відвідувачів за день надзвичайно низька, імовірність приходу 100, 200 чи 300 людей значно вища, однак ймовірність 7612 візитів знову є надзвичайно низькою. Характеристика випадкової величини, яка описує ймовірність набуття цією величиною різних значень, називається розподілом ймовірностей випадкової величини (скорочено: розподіл випадкової величини, ще коротше: розподіл). Розподіл випадкової величини може представлятись у табличній формі, або у вигляді функції розподілу. Функція розподілу ймовірностей в свою чергу може бути представленою двояко: у вигляді функції густини ймовірності та кумулятивної функції розподілу. Функція густини ймовірності (*probability density function, pdf*) – функція, що описує імовірність випадкової величини прийняти конкретне значення. Найменше значення функції = 0 (випадкова величина не може прийняти заданого значення). Визначений інтеграл цієї функції=1. Кумулятивна функція розподілу (*cumulative distribution function, cdf*) – функція, що описує імовірність випадкової величини прийняти значення ≤ конкретного значення. Найменше значення цієї функції = 0 (випадкова величина завжди більша від заданого значення). Найбільше значення цієї функції = 1 (випадкова величина завжди ≤ конкретного значення). Інтеграл функції густини ймовірності є кумулятивною функцією розподілу, а диференціювання кумулятивної функції розподілу дасть нам функцію густини ймовірності.

Найбільш простою формою розподілу є рівномірний розподіл. Випадкова величина має рівномірний розподіл на інтервалі, якщо ймовірність прийняття будь-якого значення з цього інтервалу є сталою (однаковою для всіх значень). Рівномірний розподіл на проміжку \[0;1\] називається стандартним рівномірним розподілом.

Функція густини ймовірності рівномірного розподілу: ![Функція густини ймовірності рівномірного розподілу](http://stat.org.ua/figures/uniform-distr-pdf.png)

Кумулятивна функція рівномірного розподілу: ![Кумулятивна функція рівномірного розподілу](http://stat.org.ua/figures/uniform-distr-cdf.png)

Для генерації (створення) `N` випадкових величин, рівномірно розподілених на інтервалі `[min;max]` у `R` існує функція `runif(N,min,max)`.

Найбільш важливим та часто спостережуваним у природі (і у фармації) розподілом випадкових величин є нормальний розподіл (розподіл Гауса). Нормальний розподіл — розподіл ймовірностей випадкової величини, що виникає тоді, коли дана випадкова величина являє собою суму великого числа незалежних випадкових величин, кожна з яких грає в утворенні всієї суми незначну роль. Результати будь-яких повторних вимірювань, проведених над одним і тим же об'єктом, мають нормальний розподіл. Наприклад, закону нормального розподілу підкоряються об'єми титранту, використаного при титруванні аліквот узятих з одного і того ж розчину; сумарні вартості покупки, зробленої споживачами в аптеці; концентрації лікарської речовини в крові через фіксований час після введення препарату; маси таблеток, виготовлених на одному і тому ж апараті і т.д. Центральна гранична теорема стверджує, що нормальний розподіл завжди виникає тоді, коли дана випадкова величина являє собою суму великого числа незалежних випадкових величин, кожна з яких грає в утворенні всієї суми незначну роль.

Якщо рівномірні розподіли відрізняються один від одного значеннями границь інтервалів  `min` і `max`, нормальні розподіли відрізняються між собою зміщенням (математичне сподівання або середнє арифметичне) і масштабом (дисперсія). Аналогічно, нормальний розподіл із середнім значенням=0 і дисперсією=1 називається стандартним нормальним розподілом.

Функція густини ймовірності нормального розподілу: ![Функція густини ймовірності нормального розподілу](http://stat.org.ua/figures/normal-distr-pdf.png)

Кумулятивна функція нормального розподілу: ![Кумулятивна функція нормального розподілу](http://stat.org.ua/figures/normal-distr-cdf.png)

Для генерації (створення) `N` нормально розподілених випадкових величин у `R` існує функція `rnorm(N,mean,sd)`.

Важливими є деякі закономірності, пов'язані з нормальним розподілом. Так, для нормально розподіленої вибірки мода, медіана та середнє арифметичне співпадають. Також, 68.26% значень такої вибірки знаходяться в межах одного стандартного відхилення (середнє арифметичне ± 1 стандартне відхилення), 95.46% значень -  в межах двох стандартних відхилень, і 99.74% - в межах трьох стандартних відхилень. 
![Квантилі нормального розподілу](http://stat.org.ua/figures/normal-quantiles.png)

Кумулятивний відсоток на малюнку відображає частку вибірки, яка є меншою за дане значення. Тотожними кумулятивним відсоткам є процентилі. Процентилі – це ті ж самі квантилі, виражені не в частках, а у відсотках (0.25-квантиль=25-процентиль). Z-оцінка вказує на скільки стандартних відхилень дане значення віддалилось від центру вибірки. Для того, щоб отримати Z-оцінку певного значення, потрібно від цього значення відняти середнє арифметичне вибірки і поділити на стандартне відхилення: \[ Z\_i=frac{x_i-head{x}}{\sigma} \]

Переведення усіх значень вибірки у їх Z-значення називається стандартизацією вибірки. Стандартизована вибірка завжди має середнє арифметичне рівне нулю і стандартне відхилення рівне одиниці. Знаючи теоретичний розподіл деяких величин, можна встановити імовірності спостереження будь-яких результатів вимірювань.

Задача: Фармацевтична компанія виготовила серію розчинів для інфузій, розфасованих у флакони по 100 мл. Результати аналізу об'єму розчину 300 флаконів складають вибірку із середнім арифметичним та стандартним відхиленням рівними 100.3±0.7 мл. Відділ контролю якості компанії затвердив технічні умови, згідно яким об'єм розчину у 99.5% випадків повинен бути в межах 100±2 мл. Чи відповідає серія препарату поставленим вимогам?
Оскільки результати аналізу характеризуються нормальним розподілом, нам потрібно встановити, чи охоплює інтервал від 98 до 102 99.5% випадків. Для цього визначимо, яка частина флаконів має об'єм менший від 98 мл, а тоді знайдемо частину флаконів які мають об'єм більший від 102 мл, додамо їх і порівняєм із нормою 100-99.5=0.5% відхилень.
Ось як виглядає розподіл нормальний розподіл із cереднім арифметичним та стандартним відхиленням рівними 100.3±0.7 
![розподіл-приклад](http://stat.org.ua/figures/distr-example.png)
Зафарбована та частина, яка знаходиться в межах 100±2 мл. По суті, нам необхідно знайти площу незафарбованої частини і порівняти її з 0.5%.

Знайдемо Z-оцінку нижньої межі:


```r
z1 = (98 - 100.3)/0.7
z1
```

```
## [1] -3.286
```


Імовірність знайти препарат із об'ємом меншим чи рівним 98 така ж, як і імовірність спостерігати значення менші чи рівні -3.286 для стандартного нормального розподілу. Цю імовірність можна визначити із спеціальних таблиць, або використати функцію `R` `pnorm()`:


```r
pnorm(z1)
```

```
## [1] 0.0005086
```


Ця імовірність дуже низька. І справді, на графіку уся ліва частина розподілу виглядає зафарбованою. Аналогічно для верхньої межі:


```r
z2 = (102 - 100.3)/0.7
z2
```

```
## [1] 2.429
```

```r
pnorm(z2)
```

```
## [1] 0.9924
```


Це є ймовірність спостерігати флакон із об'ємом меншим чи рівним 102 мл. Нас же цікавить ймовірність перевищення 102 мл, яка становить 1-0.9924=0.0076.

Додаємо обі ймовірності щоб отримати ймовірність виходу за межі інтервалу: 0.0076+0.0005=0.0081, що становить 0.81% і є більшим ніж допустимі 0.5%. Таким чином дана серія не відповідає поставленим вимогам щодо якості наповнення флаконів.

У приведеному розв'язку ми здійснювали обчислення Z-оцінки з метою проілюструвати її роль у вирішенні задачі. Насправді, функція `pnorm()` може здійснювати стандартизацію автоматично, для цього потрібно передати їй середнє арифметичне та стандартне відхилення як аргументи: `pnorm(98,100.3,0.7)` для нижньої межі та `pnorm(102,100.3,0.7)` для верхньої.

Крім того, Z-трансформація використовується для пошуку викидів. Так, якщо розмір вибірки невеликий (<100), результат із Z-оцінкою > 3 або < -3 може кваліфікуватись як викид.


